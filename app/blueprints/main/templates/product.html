{% extends 'base.html' %}
{% block title %}{{ product.name if product else 'Product' }} - Sam's Nik Naks{% endblock %}
{% block content %}

<!-- Hero/Title -->
<section class="relative bg-gradient-to-b from-slate-900 to-slate-800 text-white py-12">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <a href="{{ url_for('main.shop') }}" class="text-sm text-slate-300 hover:underline">← Back to Shop</a>
    <h1 class="mt-3 text-3xl sm:text-4xl font-extrabold tracking-tight">{{ product.name if product else 'Product' }}</h1>
    {% if product and product.short %}
      <p class="mt-2 text-slate-200">{{ product.short }}</p>
    {% endif %}
  </div>
</section>

<!-- Product layout -->
<section class="py-16 bg-white">
  <div class="mx-auto max-w-7xl px-6 lg:px-8 grid gap-12 lg:grid-cols-2 items-start">
    <!-- Gallery -->
    <div>
      <div class="rounded-2xl overflow-hidden shadow-card bg-slate-100">
        <img src="{{ url_for('static', filename=(product.image if product else 'img/prod1.jpg')) }}" alt="{{ product.name if product else 'Product' }}" class="w-full h-auto object-cover">
      </div>
      {% if product and product.gallery %}
      <div class="mt-4 grid grid-cols-5 gap-3">
        {% for g in product.gallery %}
        <img src="{{ url_for('static', filename=g) }}" alt="Gallery image" class="w-full h-20 object-cover rounded-lg border border-slate-200">
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Details -->
    <div>
      <div class="bg-white rounded-2xl shadow-card p-6">
        {% if product and product.badge %}
          <span class="inline-block text-xs font-medium rounded-full px-2 py-1 bg-brand-100 text-brand-700">{{ product.badge }}</span>
        {% endif %}
        <div class="mt-2 flex items-center justify-between gap-3">
          <div class="text-2xl font-bold">{{ product.name if product else 'Product' }}</div>
          {% if product and product.price %}
            <div class="text-2xl font-bold">${{ '%.2f'|format(product.price) }}</div>
          {% endif %}
        </div>
        {% if product and product.rating %}
        <div class="mt-2 flex items-center gap-2 text-amber-500 text-sm">
          {% for _ in range(product.rating|int) %}
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.802 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.802-2.034a1 1 0 00-1.175 0l-2.802 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.88 8.72c-.783-.57-.38-1.81.588-1.81H6.93a1 1 0 00.95-.69l1.07-3.292z"/></svg>
          {% endfor %}
          <span class="text-slate-600">{{ product.rating }}/5</span>
        </div>
        {% endif %}

        {% if product and product.description %}
          <p class="mt-4 text-slate-700">{{ product.description }}</p>
        {% endif %}

        <!-- Options (placeholder for variants) -->
        {% if product and product.variants %}
        <div class="mt-6 grid gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700">Variant</label>
            <select class="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2">
              {% for v in product.variants %}
              <option value="{{ v.id }}">{{ v.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        {% endif %}

        <!-- Add to Cart -->
        <form class="mt-6 flex items-center gap-3" action="{{ url_for('main.api_add_to_cart') }}" method="post">
          <label for="qty" class="sr-only">Quantity</label>
          <input id="qty" name="qty" type="number" min="1" value="1" class="w-20 rounded-lg border border-slate-300 px-3 py-2">
          <button class="rounded-xl bg-slate-900 px-6 py-3 text-white hover:bg-slate-800">Add to Cart</button>
        </form>

        <!-- Meta -->
        <div class="mt-6 grid gap-2 text-sm text-slate-600">
          <div>Ships in 2–4 business days</div>
          <div>Free pickup in Harrisburg, PA</div>
          <div>Secure checkout</div>
        </div>
      </div>

      <!-- Details tabs -->
      <div class="mt-8 grid gap-6">
        <div class="bg-white rounded-2xl shadow-card p-6">
          <h3 class="font-semibold">Materials & Care</h3>
          <p class="mt-2 text-slate-700">High-quality resin with durable pigments. Clean with a soft cloth; avoid harsh chemicals and direct heat.</p>
        </div>
        <div class="bg-white rounded-2xl shadow-card p-6">
          <h3 class="font-semibold">Shipping & Returns</h3>
          <p class="mt-2 text-slate-700">Ships via USPS. Returns accepted within 30 days (see <a class="text-brand-700 hover:underline" href="{{ url_for('main.returns') }}">policy</a>).</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- More products -->
<section class="py-16 bg-slate-50">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <h2 class="text-2xl font-bold">You may also like</h2>
    {% if related and related|length > 0 %}
    <div class="mt-6 grid gap-6 grid-cols-2 md:grid-cols-4">
      {% for p in related %}
      <a href="{{ url_for('main.product', slug=p.slug) }}" class="group rounded-2xl shadow-card overflow-hidden bg-white">
        <div class="aspect-[4/3] bg-slate-100">
          <img src="{{ url_for('static', filename=p.image) }}" alt="{{ p.name }}" class="w-full h-full object-cover group-hover:scale-[1.02] transition-transform">
        </div>
        <div class="p-3">
          <div class="flex items-center justify-between gap-2">
            <div class="text-sm font-semibold">{{ p.name }}</div>
            {% if p.price %}<div class="text-sm font-semibold">${{ '%.2f'|format(p.price) }}</div>{% endif %}
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
    {% else %}
    <p class="mt-3 text-slate-600">Check back soon for related items.</p>
    {% endif %}
  </div>
</section>

{% endblock %}
